<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>SQLAlchemy - Storing Application Version Strings - Chase Seibert Blog</title>
<meta name="description" content="One example of when you might need to store application version numbers in your database is when you’re tracking which users have which versions of a mobile app installed. In that case, you may want to preserve the ability to easily sort the version numbers, so you can answer questions like “Which users have a version greater than or equal to 9.3.2?”">


  <meta name="author" content="Chase Seibert">
  
  <meta property="article:author" content="Chase Seibert">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chase Seibert Blog">
<meta property="og:title" content="SQLAlchemy - Storing Application Version Strings">
<meta property="og:url" content="https://chase-seibert.github.io/blog/2016/05/27/sqlalchemy-version-string-column-type.html">


  <meta property="og:description" content="One example of when you might need to store application version numbers in your database is when you’re tracking which users have which versions of a mobile app installed. In that case, you may want to preserve the ability to easily sort the version numbers, so you can answer questions like “Which users have a version greater than or equal to 9.3.2?”">





  <meta name="twitter:site" content="@chase_seibert">
  <meta name="twitter:title" content="SQLAlchemy - Storing Application Version Strings">
  <meta name="twitter:description" content="One example of when you might need to store application version numbers in your database is when you’re tracking which users have which versions of a mobile app installed. In that case, you may want to preserve the ability to easily sort the version numbers, so you can answer questions like “Which users have a version greater than or equal to 9.3.2?”">
  <meta name="twitter:url" content="https://chase-seibert.github.io/blog/2016/05/27/sqlalchemy-version-string-column-type.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2016-05-27T00:00:00+00:00">






<link rel="canonical" href="https://chase-seibert.github.io/blog/2016/05/27/sqlalchemy-version-string-column-type.html">







  <meta name="google-site-verification" content="KbUN2yK33xTFIQa6xopl2QZyG02prTwsPwnCTjRRYMM" />






<!-- end _includes/seo.html -->



  <link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Chase Seibert Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">
<a rel="me" href="https://hachyderm.io/@chase_seibert"></a>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          Chase Seibert Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/blog/me/"
                
                
              >Top Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/reading-list/"
                
                
              >Reading List</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/resume.pdf"
                
                
              >Resume</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://chase-seibert.github.io/blog/">
        <img src="/blog/images/chase-square.jpg" alt="Chase Seibert" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://chase-seibert.github.io/blog/" itemprop="url">Chase Seibert</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Director of Engineering at Dropbox</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://www.facebook.com/chase.seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/chase-seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.goodreads.com/chaseseibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-goodreads" aria-hidden="true"></i><span class="label">Goodreads</span></a></li>
          
        
          
            <li><a href="https://letterboxd.com/quasigenx/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-film" aria-hidden="true"></i><span class="label">Letterboxd</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/chaseseibert/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://hachyderm.io/@chase_seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/7679" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="SQLAlchemy - Storing Application Version Strings">
    <meta itemprop="description" content="One example of when you might need to store application version numbers inyour database is when you’re tracking which users have which versions of amobile app installed. In that case, you may want to preserve the ability toeasily sort the version numbers, so you can answer questions like “Which usershave a version greater than or equal to 9.3.2?”">
    <meta itemprop="datePublished" content="2016-05-27T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://chase-seibert.github.io/blog/2016/05/27/sqlalchemy-version-string-column-type.html" itemprop="url">SQLAlchemy - Storing Application Version Strings
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>One example of when you might need to store application version numbers in
your database is when you’re tracking which users have which versions of a
mobile app installed. In that case, you may want to preserve the ability to
easily sort the version numbers, so you can answer questions like “Which users
have a version greater than or equal to 9.3.2?”</p>

<p>In that case, you have two options. You can store the version number in three
different fields, such as major, minor and revision number. Or, you can pad
the values such that regular string sorting would work. Why? Because otherwise,
the sorting will be incorrect. For example, the string <code class="language-plaintext highlighter-rouge">10.0.0</code> is less than
the string <code class="language-plaintext highlighter-rouge">9.0.0</code> because the first character <code class="language-plaintext highlighter-rouge">9</code> is greater than <code class="language-plaintext highlighter-rouge">1</code>. This
would be the behavior you would get with a simple
<code class="language-plaintext highlighter-rouge">SELECT * FROM users ORDER BY version DESC;</code></p>

<p>For example, the version <code class="language-plaintext highlighter-rouge">9.3.2</code> might be stored as <code class="language-plaintext highlighter-rouge">0009.0003.0002</code>. Here is
a drop-in implementation in SQLAlchemy which allows you to only deal with the
“nice” native format in Python, while storing the padded version in the
database.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">types</span>


<span class="k">def</span> <span class="nf">to_version_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">VERSION_DELIM</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">VERSION_NUMBER_PIECES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'Version string has too many parts'</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">VERSION_NUMBER_PIECES</span><span class="p">:</span>
        <span class="n">parts</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'0'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">part</span><span class="p">))</span> <span class="o">==</span> <span class="n">part</span>
        <span class="k">except</span> <span class="p">(</span><span class="nb">ValueError</span><span class="p">,</span> <span class="nb">AssertionError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'Version part is not an integer'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">VERSION_DELIM</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">part</span><span class="p">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">from_version_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">VERSION_DELIM</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">VERSION_DELIM</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">part</span><span class="p">))</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">VersionString</span><span class="p">(</span><span class="n">types</span><span class="p">.</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="s">""" stores a string like '0.9.4' as '0000.0009.0004' so it can be sorted """</span>

    <span class="n">impl</span> <span class="o">=</span> <span class="n">types</span><span class="p">.</span><span class="n">String</span>

    <span class="k">def</span> <span class="nf">process_bind_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">to_version_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">from_version_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></div>

<p>And some quick tests:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">to_version_string</span><span class="p">,</span> <span class="n">from_version_string</span>


<span class="k">class</span> <span class="nc">VersionStringTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_to_version_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">to_version_string</span><span class="p">(</span><span class="s">'9.3.2'</span><span class="p">),</span> <span class="s">'0009.0003.0002'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">to_version_string</span><span class="p">(</span><span class="s">'9.3'</span><span class="p">),</span> <span class="s">'0009.0003.0000'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">to_version_string</span><span class="p">(</span><span class="s">'9'</span><span class="p">),</span> <span class="s">'0009.0000.0000'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">to_version_string</span><span class="p">(</span><span class="s">''</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">to_version_string</span><span class="p">(</span><span class="bp">None</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_to_version_string_bad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s">'9.3.2.1'</span><span class="p">,</span>
            <span class="s">'9.3.a'</span><span class="p">,</span>
            <span class="s">'9.03.2'</span><span class="p">,</span>
            <span class="s">'foobar'</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="nb">ValueError</span><span class="p">):</span>
                <span class="n">to_version_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_from_version_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">from_version_string</span><span class="p">(</span><span class="s">'0009.0003.0002'</span><span class="p">),</span> <span class="s">'9.3.2'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">from_version_string</span><span class="p">(</span><span class="s">'0000.0000.0000'</span><span class="p">),</span> <span class="s">'0.0.0'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">from_version_string</span><span class="p">(</span><span class="bp">None</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        




    <p class="page__date">
        <strong><i class="fas fa-fw fa-edit" aria-hidden="true"></i> GitHub:</strong>
        <a href="https://github.com/chase-seibert/blog/blob/master/_posts/2016-05-27-sqlalchemy-version-string-column-type.md">_posts/2016-05-27-sqlalchemy-version-string-column-type.md</a>
    </p>

        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2016-05-27T00:00:00+00:00">May 27, 2016</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2016/05/13/agile-points-vs-hours.html" class="pagination--pager" title="Using Points vs Hours for Estimates">Previous</a>
    
    
      <a href="/blog/2016/06/24/management-101.html" class="pagination--pager" title="Management 101">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://chase-seibert.github.io">Chase Seibert Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>









  </body>
</html>
