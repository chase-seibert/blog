<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Why Database Integrity Matters - Chase Seibert Blog</title>
<meta name="description" content="Given the rise in popularity of NoSQL solutions, typically set apart by their explicit forfeiture of traditional RDBMS features, you might think that age old concepts like ACID transactions and foreign key constraints are simply antiquated. In the face of the new shiny hotness, why did we ever value data integrity so highly, anyway?">


  <meta name="author" content="Chase Seibert">
  
  <meta property="article:author" content="Chase Seibert">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chase Seibert Blog">
<meta property="og:title" content="Why Database Integrity Matters">
<meta property="og:url" content="https://chase-seibert.github.io/blog/2013/02/16/why-database-acid-matters.html">


  <meta property="og:description" content="Given the rise in popularity of NoSQL solutions, typically set apart by their explicit forfeiture of traditional RDBMS features, you might think that age old concepts like ACID transactions and foreign key constraints are simply antiquated. In the face of the new shiny hotness, why did we ever value data integrity so highly, anyway?">





  <meta name="twitter:site" content="@chase_seibert">
  <meta name="twitter:title" content="Why Database Integrity Matters">
  <meta name="twitter:description" content="Given the rise in popularity of NoSQL solutions, typically set apart by their explicit forfeiture of traditional RDBMS features, you might think that age old concepts like ACID transactions and foreign key constraints are simply antiquated. In the face of the new shiny hotness, why did we ever value data integrity so highly, anyway?">
  <meta name="twitter:url" content="https://chase-seibert.github.io/blog/2013/02/16/why-database-acid-matters.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2013-02-16T00:00:00+00:00">






<link rel="canonical" href="https://chase-seibert.github.io/blog/2013/02/16/why-database-acid-matters.html">







  <meta name="google-site-verification" content="KbUN2yK33xTFIQa6xopl2QZyG02prTwsPwnCTjRRYMM" />






<!-- end _includes/seo.html -->



  <link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Chase Seibert Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">
<a rel="me" href="https://hachyderm.io/@chase_seibert"></a>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          Chase Seibert Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/blog/me/"
                
                
              >Top Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/reading-list/"
                
                
              >Reading List</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/resume.pdf"
                
                
              >Resume</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://chase-seibert.github.io/blog/">
        <img src="/blog/images/chase-square.jpg" alt="Chase Seibert" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://chase-seibert.github.io/blog/" itemprop="url">Chase Seibert</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Director of Engineering at Dropbox</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://www.facebook.com/chase.seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/chase-seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.goodreads.com/chaseseibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-goodreads" aria-hidden="true"></i><span class="label">Goodreads</span></a></li>
          
        
          
            <li><a href="https://letterboxd.com/quasigenx/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-film" aria-hidden="true"></i><span class="label">Letterboxd</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/chaseseibert/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://hachyderm.io/@chase_seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/7679" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Why Database Integrity Matters">
    <meta itemprop="description" content="Given the rise in popularity of NoSQL solutions, typically set apart by their explicit forfeiture of traditional RDBMS features, you might think that age old concepts like ACID transactions and foreign key constraints are simply antiquated. In the face of the new shiny hotness, why did we ever value data integrity so highly, anyway?">
    <meta itemprop="datePublished" content="2013-02-16T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://chase-seibert.github.io/blog/2013/02/16/why-database-acid-matters.html" itemprop="url">Why Database Integrity Matters
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Given the rise in popularity of <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> solutions, typically set apart by their explicit forfeiture of traditional <a href="http://en.wikipedia.org/wiki/Relational_database_management_system">RDBMS</a> features, you might think that age old concepts like ACID transactions and foreign key constraints are simply antiquated. In the face of the new shiny hotness, why did we ever value <a href="ftp://public.dhe.ibm.com/software/solutions/soa/pdfs/Whydataintegritymatters-trifold.pdf">data integrity</a> so highly, anyway?</p>

<p>Personally, I think it’s critical to realize that NoSQL solutions were born primarily out of necessity. At some extremely high volumes of data, you simply don’t have the luxury of data integrity. But that’s a problem for the Facebooks and Googles of the world. The other 99% of us are flattering ourselves if we think we have the same data scaling problems. Of course, given NoSQL tools, more data will be accumulated by smaller companies, simply because it is now practical to work with.</p>

<p>But for traditional RDBMS systems, it’s important to re-emphasize the value of data consistency. In short:</p>

<blockquote>
  <p>Anything that can happen in a schema, will happen.</p>
</blockquote>

<h1 id="soft-deletion">Soft Deletion</h1>

<p>Soft deleting a record refers to marking it as deleting, typically with a 0/1 value in a column like <code class="language-plaintext highlighter-rouge">is_deleted</code>. Some NoSQL solutions like HBase can do this natively, by keeping multiple versions of a data cell around. But it’s actually a long-standing pattern from RDBMS. Typical reasons include enabling undo features, providing audit trails and simple fear of deleting data permanently.</p>

<p>Soft deletes are totally reasonable, but there are some <a href="http://weblogs.asp.net/fbouma/archive/2009/02/19/soft-deletes-are-bad-m-kay.aspx">trade offs</a> to be aware of.</p>

<ul>
  <li>Natural primary keys become more difficult. Do you allow two user records with the same username if one is deleted?</li>
  <li>Prevents you from using the cascading delete feature of you database, leading to orphaned records.</li>
  <li>Invites logically <a href="http://ayende.com/blog/4157/avoid-soft-deletes">invalid foreign key references</a>- ie references from a soft-deleted record to a live record.</li>
  <li>Easiest to enforce through an ORM, but you won’t always be accessing the data through the ORM.</li>
</ul>

<p>Most importantly, they can slow down performance. If you have a significant amount of data, you will end up adding more indexes that you would otherwise need, simply to be sure you are always looking at non-deleted records. That will <a href="http://richarddingwall.name/2009/11/20/the-trouble-with-soft-delete/">slow down writes</a> to some extent. You could regularly delete soft-deleted records, but in practice I have not seen people actually doing that regularly.</p>

<p>It’s easy to get into a situation where you have multiple soft-deleted versions of every record. You may find that you have more deleted data than live data! One alternative to soft-deletes is to put these records into a separate archive. It could even be another RDBMS. If you really ever do need the data, it will be there. But don’t be surprised if you never use it.</p>

<h1 id="foreign-key-constraints">Foreign Key Constraints</h1>

<p>There seems to be a misunderstanding that “Real Internet Applications Don’t Use Foreign Keys” (<a href="http://www.thisblog.runsfreesoftware.com/?q=2009/03/20/real-internet-applications-dont-use-foreign-keys">source</a>). Let me assure you, foreign key constraints are an absolutely fundamental building block of most of the web apps that you use. It’s what the “relational” in RDBMS stands for!</p>

<p>Foreign keys are the primary method for enforcing data integrity. Without them, you are inviting <a href="http://stackoverflow.com/questions/83147/whats-wrong-with-foreign-keys">orphaned rows and giving up cascading deletes</a>. These are similar trade-offs to use soft deletes. In fact, soft deletes can <a href="http://stackoverflow.com/questions/3492485/mysql-with-soft-deletion-unique-key-and-foreign-key-constraints">exacerbate the issue</a>.</p>

<p>In the end, not using foreign keys is similar to not <a href="http://www.oreillynet.com/onlamp/blog/2006/05/misunderstanding_foreign_keys.html">validating your input</a>. You’re assuming that your infallible application layer will never insert bad data into the system. First of all, that’s just wishful thinking. In practice, I have observed that if the schema allows bad data, you will eventually see that exact form of bad data in the system. Better to put as much data validation as you can right next to the data itself, where it is much harder to circumvent.</p>

<h1 id="transactions">Transactions</h1>

<p><a href="http://en.wikipedia.org/wiki/ACID">ACID</a> compliance is a big deal. Databases competed on this playing field for decades. Yes, transactions absolutely do slow down performance. Would you rather have wrong answers quickly, or correct answers a few milliseconds later?</p>

<p>Yes, transactions <a href="http://jasonswett.net/blog/why-you-should-use-database-transactions/">can throw errors</a> when you are inserting data. You can’t insert bad data; that’s the point! When you say you want to disable transactions because “I don’t ever want to loose data”, I hear “I would rather have bad data in the system than no data”. (Application layer isn’t looking so infallible now, is it?) In general, transactions reduce the scope of data problems from “I just inserted a bunch of invalid data, let’s fix the ‘bugs’ in the application layer to deal with it” to “one user got an error trying to insert bad data”. IMHO, that’s a good thing.</p>

<h1 id="json-data">JSON Data</h1>

<p>Like all of these anti-patterns, putting JSON data into your relational database is fine in small doses. I actually think it’s advisable when dealing will small bits of schema-less data. But it should be the exception, not the rule. It’s all too easy to avoid the small up-front cost of parsing the data and defining a schema, only to find that you’re fighting bugs in your application when you’re trying to do just that on the fly per-request.</p>

<ul>
  <li>You’re relying on your application layer to validate the format; the database can’t even check that it IS JSON. (Unless you use <a href="http://www.postgresql.org/docs/devel/static/datatype-json.html">Postgres</a>)</li>
  <li>You can’t index inside this field.</li>
  <li>You are probably storing these as TEXT to account for their in determinant length; MySQL in particular can’t do <a href="http://dev.mysql.com/doc/refman/5.1/en/internal-temporary-tables.html">standard optimizations</a> on tables with TEXT blobs.</li>
</ul>

<p>Note: the later is also <a href="http://stackoverflow.com/questions/348416/in-postgresql-is-it-faster-to-include-text-columns-in-the-same-table-rather-th">not a problem</a> on Postgres.</p>

<h1 id="conclusion">Conclusion</h1>

<p>In the final analysis, poor data integrity is really all about <em>SPEED</em>. Not the speed of your application, but the speed of your engineers. Soft deletion, disabling foreign keys, eschewing transactions and not normalizing data properly all have their valid use cases. But over-used, you’re slowing down every engineer that has to write new code on top of the database by inundating them with edge cases they frankly shouldn’t have to worry about.</p>

<p>They have a reference to an active user, but the required profile record is soft-deleted. Add more code to deal with that. I tried to show the user a link from an invoice to their internal CRM with a reference_id, but that key was missing from the json column. Add more code to deal with that. Not to mention volume of bugs that can be traced back to data integrity issues.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/blog/tags/#database" class="page__taxonomy-item p-category" rel="tag">database</a>
    
    </span>
  </p>






    <p class="page__date">
        <strong><i class="fas fa-fw fa-edit" aria-hidden="true"></i> GitHub:</strong>
        <a href="https://github.com/chase-seibert/blog/blob/master/_posts/2013-02-16-why-database-acid-matters.md">_posts/2013-02-16-why-database-acid-matters.md</a>
    </p>

        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2013-02-16T00:00:00+00:00">February 16, 2013</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2013/02/10/pig-hbase-flatten-column-family.html" class="pagination--pager" title="Flatten entire HBase column families with Pig and Python UDFs">Previous</a>
    
    
      <a href="/blog/2013/02/25/facebook-insights-api-post-level-returns-empty.html" class="pagination--pager" title="Facebook Page Post Insights Empty Results">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://chase-seibert.github.io">Chase Seibert Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>









  </body>
</html>
