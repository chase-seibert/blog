<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Python smtplib long header folding using tabs instead of spaces - Chase Seibert Blog</title>
<meta name="description" content="Unless you have done a lot of work with generating and parsing emails, you are probably not intimately familiar with the details of the MIME format. Here is an example of a MIME encoded email:">


  <meta name="author" content="Chase Seibert">
  
  <meta property="article:author" content="Chase Seibert">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chase Seibert Blog">
<meta property="og:title" content="Python smtplib long header folding using tabs instead of spaces">
<meta property="og:url" content="https://chase-seibert.github.io/blog/2009/12/15/python-smtplib-long-header-folding-using-tabs-instead-of-spaces.html">


  <meta property="og:description" content="Unless you have done a lot of work with generating and parsing emails, you are probably not intimately familiar with the details of the MIME format. Here is an example of a MIME encoded email:">





  <meta name="twitter:site" content="@chase_seibert">
  <meta name="twitter:title" content="Python smtplib long header folding using tabs instead of spaces">
  <meta name="twitter:description" content="Unless you have done a lot of work with generating and parsing emails, you are probably not intimately familiar with the details of the MIME format. Here is an example of a MIME encoded email:">
  <meta name="twitter:url" content="https://chase-seibert.github.io/blog/2009/12/15/python-smtplib-long-header-folding-using-tabs-instead-of-spaces.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2009-12-15T00:00:00+00:00">






<link rel="canonical" href="https://chase-seibert.github.io/blog/2009/12/15/python-smtplib-long-header-folding-using-tabs-instead-of-spaces.html">







  <meta name="google-site-verification" content="KbUN2yK33xTFIQa6xopl2QZyG02prTwsPwnCTjRRYMM" />






<!-- end _includes/seo.html -->



  <link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Chase Seibert Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">
<a rel="me" href="https://hachyderm.io/@chase_seibert"></a>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          Chase Seibert Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/blog/me/"
                
                
              >Top Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/reading-list/"
                
                
              >Reading List</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/resume.pdf"
                
                
              >Resume</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://chase-seibert.github.io/blog/">
        <img src="/blog/images/chase-square.jpg" alt="Chase Seibert" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://chase-seibert.github.io/blog/" itemprop="url">Chase Seibert</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Director of Engineering at Dropbox</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://www.facebook.com/chase.seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/chase-seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.goodreads.com/chaseseibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-goodreads" aria-hidden="true"></i><span class="label">Goodreads</span></a></li>
          
        
          
            <li><a href="https://letterboxd.com/quasigenx/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-film" aria-hidden="true"></i><span class="label">Letterboxd</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/chaseseibert/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://hachyderm.io/@chase_seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/7679" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Python smtplib long header folding using tabs instead of spaces">
    <meta itemprop="description" content="Unless you have done a lot of work with generating and parsing emails, you are probably not intimately familiar with the details of the MIME format. Here is an example of a MIME encoded email:">
    <meta itemprop="datePublished" content="2009-12-15T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://chase-seibert.github.io/blog/2009/12/15/python-smtplib-long-header-folding-using-tabs-instead-of-spaces.html" itemprop="url">Python smtplib long header folding using tabs instead of spaces
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>
Unless you have done a lot of work with generating and parsing emails, you are probably not intimately familiar with the details of the <a href="http://tools.ietf.org/html/rfc2822">MIME format</a>. Here is an example of a MIME encoded email:
</p>

<pre name="code" class="html">
From: user1@example.com
To: user2@example.com
Subject: Christmas party!
Mime-Version: 1.0
Content-Type: multipart/mixed;
 boundary="----=_Part_20502_1870283373.1261059406023"
Date: 17 Dec 2009 09:16:46 -0500

------=_Part_20502_1870283373.1261059406023
Content-Type: multipart/alternative;
 boundary="----=_Part_20503_1134508872.1261059406023"
...
</pre>

<p>
Typically, all lines in MIME wrap at 80 characters. For headers, the standard is to break before the last whitespace under the character limit. This is defined in <a href="http://tools.ietf.org/html/rfc2822#section-2.2.3">RFC 2822, section 2.2.3</a>. So, if you have a long subject, it might look like:
</p>

<pre name="code" class="html">
...
Subject: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis
 est dolor, a faucibus nisi. Curabitur et ipsum ut arcu commodo feugiat.
...
</pre>

<p>
I ran into <a href="http://bugs.python.org/issue1974">bug 1974</a> in Python where the standard smptlib example was throwing an error on long subject lines.
</p>

<pre name="code" class="python">
    from email.MIMEText import MIMEText

    msg = MIMEText(body, "html")
    msg["From"] = "user1@example.com"
    msg["To"] = "user2@example.com"
    msg["subject"] = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis est dolor, a faucibus nisi. Curabitur et ipsum ut arcu commodo feugiat."

    ...
</pre>

<p>
When looking at the resulting email is some clients (Outlook, Thunderbird), the subject like was concatenating the words "quis" and "est" into "quisest", instead of "quis est". It turns out that smtplib is inserting a tab character in between them, which some clients ignore.
</p>

<p>
The solution was simple enough. Just set header fields as Header objects, instead of strings:
</p>

<pre name="code" class="python">
    from email.MIMEText import MIMEText
    from email.Header import Header
    import smtplib

    msg = MIMEText(body, "html")
    msg["From"] = "powerfill@powerfill.com"
    msg["To"] = to_addr
    msg["subject"] = Header(subject)

    smtp = smtplib.SMTP(settings.EMAIL_HOST, settings.EMAIL_PORT)
    smtp.sendmail(msg["From"], [msg["To"]], msg.as_string())
    smtp.quit()
</pre>

<p>
<i>Edit: Don't wrap the from/to addresses in Header object. I ran into a "TypeError: unhashable instance" deploying this code to Python 2.6.</i>
</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/blog/tags/#email" class="page__taxonomy-item p-category" rel="tag">email</a><span class="sep">, </span>
    
      <a href="/blog/tags/#python" class="page__taxonomy-item p-category" rel="tag">python</a>
    
    </span>
  </p>






    <p class="page__date">
        <strong><i class="fas fa-fw fa-edit" aria-hidden="true"></i> GitHub:</strong>
        <a href="https://github.com/chase-seibert/blog/blob/master/_posts/2009-12-15-python-smtplib-long-header-folding-using-tabs-instead-of-spaces.html">_posts/2009-12-15-python-smtplib-long-header-folding-using-tabs-instead-of-spaces.html</a>
    </p>

        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2009-12-15T00:00:00+00:00">December 15, 2009</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2009/12/08/protocol-relative-urls.html" class="pagination--pager" title="Protocol Relative URLs">Previous</a>
    
    
      <a href="/blog/2009/12/29/finding-open-vnc-hosts-with-nmap.html" class="pagination--pager" title="Finding open VNC hosts with nmap">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://chase-seibert.github.io">Chase Seibert Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>









  </body>
</html>
