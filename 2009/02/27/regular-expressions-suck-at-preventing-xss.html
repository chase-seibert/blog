<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Regular Expressions Suck at Preventing XSS - Chase Seibert Blog</title>
<meta name="description" content="Depending on who you listen to, XSS is now the top computer security vulnerability, having passed the venerable SQL injection in 2007. If you&#39;re a developer, especially a web developer, and you DON&#39;T know what XSS is, stop reading right now and start Googling.">


  <meta name="author" content="Chase Seibert">
  
  <meta property="article:author" content="Chase Seibert">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chase Seibert Blog">
<meta property="og:title" content="Regular Expressions Suck at Preventing XSS">
<meta property="og:url" content="https://chase-seibert.github.io/blog/2009/02/27/regular-expressions-suck-at-preventing-xss.html">


  <meta property="og:description" content="Depending on who you listen to, XSS is now the top computer security vulnerability, having passed the venerable SQL injection in 2007. If you&#39;re a developer, especially a web developer, and you DON&#39;T know what XSS is, stop reading right now and start Googling.">





  <meta name="twitter:site" content="@chase_seibert">
  <meta name="twitter:title" content="Regular Expressions Suck at Preventing XSS">
  <meta name="twitter:description" content="Depending on who you listen to, XSS is now the top computer security vulnerability, having passed the venerable SQL injection in 2007. If you&#39;re a developer, especially a web developer, and you DON&#39;T know what XSS is, stop reading right now and start Googling.">
  <meta name="twitter:url" content="https://chase-seibert.github.io/blog/2009/02/27/regular-expressions-suck-at-preventing-xss.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2009-02-27T00:00:00+00:00">






<link rel="canonical" href="https://chase-seibert.github.io/blog/2009/02/27/regular-expressions-suck-at-preventing-xss.html">







  <meta name="google-site-verification" content="KbUN2yK33xTFIQa6xopl2QZyG02prTwsPwnCTjRRYMM" />






<!-- end _includes/seo.html -->



  <link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Chase Seibert Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">
<a rel="me" href="https://hachyderm.io/@chase_seibert"></a>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          Chase Seibert Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/blog/me/"
                
                
              >Top Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/reading-list/"
                
                
              >Reading List</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/resume.pdf"
                
                
              >Resume</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://chase-seibert.github.io/blog/">
        <img src="/blog/images/chase-square.jpg" alt="Chase Seibert" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://chase-seibert.github.io/blog/" itemprop="url">Chase Seibert</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Director of Engineering at Dropbox</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://www.facebook.com/chase.seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/chase-seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.goodreads.com/chaseseibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-goodreads" aria-hidden="true"></i><span class="label">Goodreads</span></a></li>
          
        
          
            <li><a href="https://letterboxd.com/quasigenx/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-film" aria-hidden="true"></i><span class="label">Letterboxd</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/chaseseibert/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://hachyderm.io/@chase_seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/7679" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Regular Expressions Suck at Preventing XSS">
    <meta itemprop="description" content="Depending on who you listen to, XSS is now the top computer security vulnerability, having passed the venerable SQL injection in 2007. If you&#39;re a developer, especially a web developer, and you DON&#39;T know what XSS is, stop reading right now and start Googling.">
    <meta itemprop="datePublished" content="2009-02-27T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://chase-seibert.github.io/blog/2009/02/27/regular-expressions-suck-at-preventing-xss.html" itemprop="url">Regular Expressions Suck at Preventing XSS
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>
Depending on <a href="http://www.owasp.org/index.php/Top_10_2007">who</a> you <a href="http://attrition.org/pipermail/vim/2006-September/001032.html">listen</a> to, XSS is now the <a href="http://www.darkreading.com/security/app-security/showArticle.jhtml?articleID=208804050">top</a> computer security vulnerability, having passed the venerable SQL injection in 2007. If you're a developer, especially a web developer, and you DON'T know what XSS is, stop reading right now and start <a href="http://www.google.com/search?q=XSS">Googling</a>.
</p>

<blockquote>
Cross-site scripting (XSS) is a type of computer security vulnerability typically found in web applications which allow code injection by malicious web users into the web pages viewed by other users. - <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">Wikipedia</a>
</blockquote>

<p>
Typically, the injection takes the form of javascript code. How does this code get injected into your site? There are a myriad of ways; HTML is ubiquitous these days. On the application I work on, the easiest vector is email.
</p>

<p>
We have a web-based email system. Users get an email, usually in HTML, and we display it inside our web application. It's a classic input validation problem; we're essentially presenting user generated content directly to the user, unfiltered. Well, not quite. Even from the beginning, we did some basic regex validation. The base case for XSS is via a SCRIPT tag, so we try to strip those. I am a big fan of regular expressions; they are great. But in this case, it's like beating off a mugger with a wet noodle.
</p>

<p>
Many other systems need to do the same thing. See Jeff Atwood's <a href="http://www.codinghorror.com/blog/archives/001172.html">solution</a> for Stack Overflow, where they allow HTML formatted code snippets to be submitted by the users. He's not alone; <a href="http://shiflett.org/blog/2007/mar/allowing-html-and-preventing-xss">developers</a> all <a href="http://snipplr.com/view/9596/secure-advanced-better-faster-function-for-removestrip-tagsantixss/">seem</a> to initially <a href="http://stackoverflow.com/questions/24723/best-regex-to-catch-xss-cross-site-scripting-attack-in-java">gravitate</a> to regular expressions for this task.
</p>

<p>
I contest that you really, really don't want to do this with regular expressions. Regular expressions are <a href="http://oubliette.alpha-geek.com/2003/12/31/do_not_do_not_parse_html_with_regexs">notoriously bad</a> at parsing HTML, <a href="http://wiki.tcl.tk/4164">XML</a> or any nested tag language. You don't want to be a <a href="http://sandersn.com/blog/index.php?title=avoid_casual_parsing&more=1&c=1&tb=1&pb=1">casual parser</a>, especially when you're trying to strictly enforce security. They also suck at parsing email addresses, a topic I plan to cover later.
</p>

<p>
The key is that you're not just protecting against valid, vanilla HTML. You're protecting against anything that a browser can understand, and anything it can mis-understand. <span style="font-style:italic;">Browsers can be tricked into producing valid DOM from invalid HTML quite easily. </span> Browsers <span style="font-style:italic;">love</span> rending crap invalid HTML; they even take pride in it.
</p>

<p>
For example, see this list of <a href="http://ha.ckers.org/xss.html">obfuscated XSS attacks</a>. Are you prepared to tailor a regex to prevent this real world attack on <a href="http://www.greymagic.com/security/advisories/gm005-mc/">Yahoo and Hotmail</a> on IE6/7/8?
</p>

<pre name="code" class="html">
   &lt;HTML&gt;&lt;BODY&gt;
   &lt;?xml:namespace prefix="t" ns="urn:schemas-microsoft-com:time"&gt;
   &lt;?import namespace="t" implementation="#default#time2"&gt;
   &lt;t:set attributeName="innerHTML" to="XSS&amp;lt;SCRIPT DEFER&amp;gt;alert(&amp;quot;XSS&amp;quot;)&amp;lt;/SCRIPT&amp;gt;"&gt;
   &lt;/BODY&gt;&lt;/HTML&gt;
</pre>

<p>
How about this attack that works on IE6?
</p>

<pre name="code" class="html">
    &lt;TABLE BACKGROUND="javascript:alert('XSS')"&gt;
</pre>

<p>
How about attacks that are not listed on this site? The problem with Jeff's approach is that it's not a whitelist, as claimed. It's only stripping <span style="font-style:italic;">well-behaved</span> tags. We want to strip malicious tags! As someone on <a href="http://refactormycode.com/codes/333-sanitize-html#refactor_13642">this page</a> adeptly notes:
</p>

<blockquote>
The problem with it, is that the html must be clean. There are cases where you can pass in hacked html, and it won't match it, in which case it'll return the hacked html string as it won't match anything to replace. This isn't strictly whitelisting.
</blockquote>

<p>
Why use a regex to parse HTML at all? Use a damn parser! I would suggest a purpose built tool like <a href="http://www.owasp.org/index.php/Category:OWASP_AntiSamy_Project">AntiSamy</a>. It works by actually parsing the HTML, and then traversing the DOM and removing anything that's not in the <span style="font-style:italic;">configurable</span> whitelist. The major difference is the ability to gracefully handle malformed HTML. I hear you complaining about performance already. To that, I would simply ask whether you feel that HTML rendering time significantly impacts the users perception of performance in their regular browsing. Yeah, I didn't think so. You can spare a few extra milliseconds to do this correctly.
</p>

<p>
The best part is that AntiSamy actually unit tests for all the XSS attacks on the above site. Ant it's damn easy to use:
</p>

<pre name="code" class="java">
    public String toSafeHtml(String html) throws ScanException, PolicyException {

        Policy policy = Policy.getInstance(POLICY_FILE);
        AntiSamy antiSamy = new AntiSamy();
        CleanResults cleanResults = antiSamy.scan(html, policy);
        return cleanResults.getCleanHTML().trim();
    }
</pre>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/blog/tags/#security" class="page__taxonomy-item p-category" rel="tag">security</a><span class="sep">, </span>
    
      <a href="/blog/tags/#xss" class="page__taxonomy-item p-category" rel="tag">xss</a>
    
    </span>
  </p>






    <p class="page__date">
        <strong><i class="fas fa-fw fa-edit" aria-hidden="true"></i> GitHub:</strong>
        <a href="https://github.com/chase-seibert/blog/blob/master/_posts/2009-02-27-regular-expressions-suck-at-preventing-xss.html">_posts/2009-02-27-regular-expressions-suck-at-preventing-xss.html</a>
    </p>

        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2009-02-27T00:00:00+00:00">February 27, 2009</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2009/02/19/deploying-jersey-to-jboss.html" class="pagination--pager" title="Deploying Jersey to JBOSS">Previous</a>
    
    
      <a href="/blog/2009/03/03/uk-county-codes.html" class="pagination--pager" title="UK county codes">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://chase-seibert.github.io">Chase Seibert Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>









  </body>
</html>
