<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Python Mock Cookbook - Chase Seibert Blog</title>
<meta name="description" content="The python mock library is one of the awesome things about working in Python. No matter what code you’re unit testing, it’s possible to mock out various pieces with very little test code. That being said, it’s sometimes difficult to figure out the exact syntax for your situation. I attribute this to the nature of how you apply the mocks. Sometimes it feel like you’re shooting in the dark.">


  <meta name="author" content="Chase Seibert">
  
  <meta property="article:author" content="Chase Seibert">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chase Seibert Blog">
<meta property="og:title" content="Python Mock Cookbook">
<meta property="og:url" content="https://chase-seibert.github.io/blog/2015/06/25/python-mocking-cookbook.html">


  <meta property="og:description" content="The python mock library is one of the awesome things about working in Python. No matter what code you’re unit testing, it’s possible to mock out various pieces with very little test code. That being said, it’s sometimes difficult to figure out the exact syntax for your situation. I attribute this to the nature of how you apply the mocks. Sometimes it feel like you’re shooting in the dark.">





  <meta name="twitter:site" content="@chase_seibert">
  <meta name="twitter:title" content="Python Mock Cookbook">
  <meta name="twitter:description" content="The python mock library is one of the awesome things about working in Python. No matter what code you’re unit testing, it’s possible to mock out various pieces with very little test code. That being said, it’s sometimes difficult to figure out the exact syntax for your situation. I attribute this to the nature of how you apply the mocks. Sometimes it feel like you’re shooting in the dark.">
  <meta name="twitter:url" content="https://chase-seibert.github.io/blog/2015/06/25/python-mocking-cookbook.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2015-06-25T00:00:00+00:00">






<link rel="canonical" href="https://chase-seibert.github.io/blog/2015/06/25/python-mocking-cookbook.html">







  <meta name="google-site-verification" content="KbUN2yK33xTFIQa6xopl2QZyG02prTwsPwnCTjRRYMM" />






<!-- end _includes/seo.html -->



  <link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Chase Seibert Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">
<a rel="me" href="https://hachyderm.io/@chase_seibert"></a>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          Chase Seibert Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/blog/me/"
                
                
              >Top Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/reading-list/"
                
                
              >Reading List</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/resume.pdf"
                
                
              >Resume</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://chase-seibert.github.io/blog/">
        <img src="/blog/images/chase-square.jpg" alt="Chase Seibert" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://chase-seibert.github.io/blog/" itemprop="url">Chase Seibert</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Director of Engineering at Dropbox</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://www.facebook.com/chase.seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/chase-seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.goodreads.com/chaseseibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-goodreads" aria-hidden="true"></i><span class="label">Goodreads</span></a></li>
          
        
          
            <li><a href="https://letterboxd.com/quasigenx/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-film" aria-hidden="true"></i><span class="label">Letterboxd</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/chaseseibert/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://hachyderm.io/@chase_seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/7679" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Python Mock Cookbook">
    <meta itemprop="description" content="The python mock library is one of the awesome things about working in Python. No matter what code you’re unit testing, it’s possible to mock out various pieces with very little test code. That being said, it’s sometimes difficult to figure out the exact syntax for your situation. I attribute this to the nature of how you apply the mocks. Sometimes it feel like you’re shooting in the dark.">
    <meta itemprop="datePublished" content="2015-06-25T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://chase-seibert.github.io/blog/2015/06/25/python-mocking-cookbook.html" itemprop="url">Python Mock Cookbook
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>The python <a href="https://pypi.python.org/pypi/mock">mock</a> library is one of the awesome things about working in Python. No matter what code you’re unit testing, it’s possible to mock out various pieces with very little test code. That being said, it’s sometimes difficult to figure out the exact syntax for your situation. I attribute this to the nature of how you apply the mocks. Sometimes it feel like you’re shooting in the dark.</p>

<p>The <a href="https://docs.python.org/3/library/unittest.mock.html">official documentation</a> is comprehensive, but I find it somewhat hard to locate what you’re looking for. I recommend their <a href="http://www.voidspace.org.uk/python/mock/examples.html">examples doc</a>.</p>

<p>This post is a write-up of my own personal usage.</p>

<h1 id="big-upfront-caveat">Big Upfront Caveat</h1>

<p>The biggest mistake people make is mocking something out in the wrong place. <em>You always need to mock the thing where it’s imported TO, not where it’s imported FROM.</em> Translation: if you’re importing <code class="language-plaintext highlighter-rouge">from foo import bar</code> into a package <code class="language-plaintext highlighter-rouge">bat.baz</code>, you need to mock it as <code class="language-plaintext highlighter-rouge">@mock.patch('bat.baz.bar')</code>. This can be confusing if you think you should be mocking it where it’s defined, not where it’s used.</p>

<h1 id="setup">Setup</h1>

<p>For all these sections, assume we’re in a package called <code class="language-plaintext highlighter-rouge">myapp</code>. The code you’re testing is in a module at <code class="language-plaintext highlighter-rouge">myapp.app</code> and the definition of the objects that you’re mocking is imported there from <code class="language-plaintext highlighter-rouge">myapp.lib</code>.</p>

<p>Want to see the full code? I have an repository on git with these examples called <a href="https://github.com/chase-seibert/python-mocking">python-mocking</a>.</p>

<h1 id="constants">Constants</h1>

<p>The easiest things to mock out are constants.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.MAX_ITEMS'</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="p">...</span>
</code></pre></div></div>

<h1 id="functions">Functions</h1>

<p>For functions, you will commonly need to specify a return value, check if they were called, and with what values.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.get_first_name'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_get_first_name</span><span class="p">):</span>
    <span class="n">mock_get_first_name</span><span class="p">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s">'Bat'</span>
    <span class="p">...</span>
    <span class="n">mock_get_first_name</span><span class="p">.</span><span class="n">assert_called</span><span class="p">()</span>
    <span class="n">mock_get_first_name</span><span class="p">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s">'baz'</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="methods">Methods</h1>

<p>Mocking a method on a class is just like mocking a function, you just reference it through the class name.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.Car.get_make'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_get_make</span><span class="p">):</span>
    <span class="n">mock_get_make</span><span class="p">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="s">'Ford'</span>
    <span class="p">...</span>
    <span class="n">mock_get_make</span><span class="p">.</span><span class="n">assert_called</span><span class="p">()</span>
</code></pre></div></div>

<h1 id="properties">Properties</h1>

<p>These are just special methods on a class with the <code class="language-plaintext highlighter-rouge">@property</code> decorator. Now we’re starting to get tricky.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.Car.wheels'</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">mock</span><span class="p">.</span><span class="n">PropertyMock</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_wheels</span><span class="p">):</span>
    <span class="n">mock_wheels</span><span class="p">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p">...</span>
</code></pre></div></div>

<h1 id="entire-classes">Entire classes</h1>

<p>What if you want to swap out an entire class implementation? No problem! The key is that the <code class="language-plaintext highlighter-rouge">return_value</code> should be a new instance of the class.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.Car'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_car</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">NewCar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">get_make</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">'Audi'</span>

        <span class="o">@</span><span class="nb">property</span>
        <span class="k">def</span> <span class="nf">wheels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">6</span>

    <span class="n">mock_car</span><span class="p">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">NewCar</span><span class="p">()</span>
    <span class="p">...</span>
</code></pre></div></div>

<h1 id="class-methods">Class Methods</h1>

<p>What about a <code class="language-plaintext highlighter-rouge">@classmethod</code> on a class? It’s the same as a method.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.Car.for_make'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_classmethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_for_make</span><span class="p">):</span>
    <span class="n">new_car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">()</span>
    <span class="n">new_car</span><span class="p">.</span><span class="n">make</span> <span class="o">=</span> <span class="s">'Chevy'</span>
    <span class="n">mock_for_make</span><span class="p">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">new_car</span>
    <span class="p">...</span>
</code></pre></div></div>

<h1 id="static-methods">Static Methods</h1>

<p>Static methods are the same as class methods.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.Car.roll_call'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_classmethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_get_roll_call</span><span class="p">):</span>
    <span class="n">mock_get_roll_call</span><span class="p">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">Car</span><span class="p">(</span><span class="s">'Ford'</span><span class="p">),</span> <span class="p">]</span>
    <span class="p">...</span>
</code></pre></div></div>

<h1 id="decorators--context-managers">Decorators &amp; Context Managers</h1>

<p>Decorators are a tough one. They are defined at import time, and are thus diffucult to re-define as a mock. Your best bet is to create a function for the body of the decorator, and mock that.</p>

<p>Context managers are more do-able, but tricky.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.open_car'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_context_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_open_car</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">enter_car</span><span class="p">(</span><span class="n">car</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="n">mock_open_car</span><span class="p">.</span><span class="n">return_value</span><span class="p">.</span><span class="n">__enter__</span> <span class="o">=</span> <span class="n">enter_car</span>

    <span class="p">...</span>
</code></pre></div></div>

<h1 id="bonus---mocking-all-tests-in-a-suite">Bonus - Mocking All Tests in a Suite</h1>

<p>Say you have a certain mock that you want to apply to all tests in a TestCase class. You have two options. You can apply the patch in the <code class="language-plaintext highlighter-rouge">setUp</code> and un-apply the patch in <code class="language-plaintext highlighter-rouge">tearDown</code>, or you can over-ride <code class="language-plaintext highlighter-rouge">run</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.foo'</span><span class="p">)</span> <span class="k">as</span> <span class="n">foo</span><span class="p">:</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">foo</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyTestCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">run</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>

<p>Alternatively, you can mock out something in <code class="language-plaintext highlighter-rouge">setUp</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">patcher</span> <span class="o">=</span> <span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'myapp.app.foo'</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">mock_foo</span> <span class="o">=</span> <span class="n">patcher</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">patcher</span><span class="p">.</span><span class="n">stop</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">NWApiTestCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">setUp</span><span class="p">()</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/blog/tags/#python" class="page__taxonomy-item p-category" rel="tag">python</a><span class="sep">, </span>
    
      <a href="/blog/tags/#testing" class="page__taxonomy-item p-category" rel="tag">testing</a>
    
    </span>
  </p>






    <p class="page__date">
        <strong><i class="fas fa-fw fa-edit" aria-hidden="true"></i> GitHub:</strong>
        <a href="https://github.com/chase-seibert/blog/blob/master/_posts/2015-06-25-python-mocking-cookbook.md">_posts/2015-06-25-python-mocking-cookbook.md</a>
    </p>

        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2015-06-25T00:00:00+00:00">June 25, 2015</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2015/06/12/flask-werkzeug-reloader-python-dash-m.html" class="pagination--pager" title="Flask absolute import bug in debug mode">Previous</a>
    
    
      <a href="/blog/2015/07/02/what-to-unit-test.html" class="pagination--pager" title="How to write effective unit tests">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://chase-seibert.github.io">Chase Seibert Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>









  </body>
</html>
