<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Django CSRF verification failed in IE IFRAME - Chase Seibert Blog</title>
<meta name="description" content="I ran into an interesting issue with the Django&#39;s CSRF (cross site request forgery) protection this week. Some users were reporting seeing the dreaded &quot;CSRF verification failed. Request aborted.&quot; error trying to submit a particular form. Unable to reproduce the issue myself, we finally learned that this was happening when coming from LinkedIn.">


  <meta name="author" content="Chase Seibert">
  
  <meta property="article:author" content="Chase Seibert">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chase Seibert Blog">
<meta property="og:title" content="Django CSRF verification failed in IE IFRAME">
<meta property="og:url" content="https://chase-seibert.github.io/blog/2011/06/17/django-csrf-verification-failed-in-ie-iframe.html">


  <meta property="og:description" content="I ran into an interesting issue with the Django&#39;s CSRF (cross site request forgery) protection this week. Some users were reporting seeing the dreaded &quot;CSRF verification failed. Request aborted.&quot; error trying to submit a particular form. Unable to reproduce the issue myself, we finally learned that this was happening when coming from LinkedIn.">





  <meta name="twitter:site" content="@chase_seibert">
  <meta name="twitter:title" content="Django CSRF verification failed in IE IFRAME">
  <meta name="twitter:description" content="I ran into an interesting issue with the Django&#39;s CSRF (cross site request forgery) protection this week. Some users were reporting seeing the dreaded &quot;CSRF verification failed. Request aborted.&quot; error trying to submit a particular form. Unable to reproduce the issue myself, we finally learned that this was happening when coming from LinkedIn.">
  <meta name="twitter:url" content="https://chase-seibert.github.io/blog/2011/06/17/django-csrf-verification-failed-in-ie-iframe.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2011-06-17T00:00:00+00:00">






<link rel="canonical" href="https://chase-seibert.github.io/blog/2011/06/17/django-csrf-verification-failed-in-ie-iframe.html">







  <meta name="google-site-verification" content="KbUN2yK33xTFIQa6xopl2QZyG02prTwsPwnCTjRRYMM" />






<!-- end _includes/seo.html -->



  <link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Chase Seibert Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">
<a rel="me" href="https://hachyderm.io/@chase_seibert"></a>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          Chase Seibert Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/blog/me/"
                
                
              >Top Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/reading-list/"
                
                
              >Reading List</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/resume.pdf"
                
                
              >Resume</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://chase-seibert.github.io/blog/">
        <img src="/blog/images/chase-square.jpg" alt="Chase Seibert" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://chase-seibert.github.io/blog/" itemprop="url">Chase Seibert</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Director of Engineering at Dropbox</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://www.facebook.com/chase.seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/chase-seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.goodreads.com/chaseseibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-goodreads" aria-hidden="true"></i><span class="label">Goodreads</span></a></li>
          
        
          
            <li><a href="https://letterboxd.com/quasigenx/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-film" aria-hidden="true"></i><span class="label">Letterboxd</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/chaseseibert/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://hachyderm.io/@chase_seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/7679" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Django CSRF verification failed in IE IFRAME">
    <meta itemprop="description" content="I ran into an interesting issue with the Django&#39;s CSRF (cross site request forgery) protection this week. Some users were reporting seeing the dreaded &quot;CSRF verification failed. Request aborted.&quot; error trying to submit a particular form. Unable to reproduce the issue myself, we finally learned that this was happening when coming from LinkedIn.">
    <meta itemprop="datePublished" content="2011-06-17T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://chase-seibert.github.io/blog/2011/06/17/django-csrf-verification-failed-in-ie-iframe.html" itemprop="url">Django CSRF verification failed in IE IFRAME
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>
I ran into an interesting issue with the <a href="https://docs.djangoproject.com/en/dev/ref/contrib/csrf/">Django's CSRF</a> (<a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross site request forgery</a>) protection this week. Some users were reporting seeing the dreaded "CSRF verification failed. Request aborted." error trying to submit a particular form. Unable to reproduce the issue myself, we finally learned that this was happening when coming from LinkedIn.
</p>

<img src="https://lh4.googleusercontent.com/-xdk2BwkOlFU/Tft1624pJGI/AAAAAAAALdw/oYl3KUxBiLo/s800/Screenshot-Now%252520Hiring%25253A%252520Sr.%252520Database%252520Analyst%252520in%252520Redwood%252520City%25252C%252520CA%252520%25257C%252520Share%252520on%252520LinkedIn%252520-%252520Mozilla%252520Firefox.png" alt="Forbidden. CSRF verification failed. Request aborted."/>

<p>
Digging deeper, it turns out only to happen in IE (6/7/8/9), and only in an IFRAME, like the one LinkedIn is using for their framebar. After some research, it was revealed that IE6 added a <a href="http://msdn.microsoft.com/en-us/library/ms537343.aspx">security feature</a> to block all <a href="http://en.wikipedia.org/wiki/HTTP_cookie#Privacy_and_third-party_cookies">third party cookies</a> by default, which includes any pages in an IFRAME on a different domain than the top level parent. There are a few options for work-arounds.
</p>

<h3>Work around #1: Framebusting</h3>

<p>
You can use javascript to "break out" of the IFRAME, essentially replacing the top level window with yourself. There are various techniques, but I like the simple:
</p>

<pre name="code" class="javascript">if(top != self) top.location.replace(location);
</pre>

<p>
However, this won't work if you want to allow IFRAMEs in somecases, say from your own domain(s). The code could quickly become brittle if you were to hard-code a whitelist of development/demo/qa/prod domains, or weak if you hard-code a blacklist. Also, it's fairly easy to intentionally break a frame buster. In the end, if you get into an <a href="http://stackoverflow.com/questions/958997/frame-buster-buster-buster-code-needed">arms race</a> with a framer, <a href="http://www.codinghorror.com/blog/2009/06/we-done-been-framed.html">you will lose</a>.
</p>

<h3>Work around #2: x-frame-options</h3>

<p>
Newer browsers actually have a mechanism to dis-allow framing your site all together, via the <a href="https://developer.mozilla.org/en/the_x-frame-options_response_header">x-frame-options HTTP header</a>. This is great, but only works on newish browsers, and is somewhat coarsely grained. You can only make an exception for same domain IFRAMEs, not arbitrary domains. Also, the user experience kind of blows; it looks like an error to the end-user.
</p>

<img src='https://lh6.googleusercontent.com/-_XPiDYZZcYg/TTnPz7ol06I/AAAAAAAALaU/f9ABuJQyrsA/s800/x-frame-options.png'>

<br><br>

<h3>Work around #3: P3P</h3>

<p>
You can send a HTTP header to tell the browser to allow third-party cookies in this instance. This uses the <a href="http://www.w3.org/P3P/">P3P standard</a>. However, it should be noted that you're essentially making legally binding claims about how you handle user data. For example, the smallest change you can make that will notify IE to allow third-party by default is:
</p>

<pre name="code" class="bash">
vim /etc/apache2/sites-available/default

# add the following
Header append P3P "CP=\"CAO PSA OUR\""

ln -s /etc/apache2/mods-available/headers.load /etc/apache2/mods-enabled/headers.load
service apache2 restart
</pre>

<p>
Here is a quick rundown of what <a href="http://www.p3pwriter.com/LRN_111.asp">legal claims</a> you're making in this case.
<ul>
<li>CAO - Identified Contact Information and Other Identified Data: access is given to identified online and physical contact information as well as to certain other identified data.</li>
<li>PSA - Information may be used to create or build a record of a particular individual or computer that is tied to a pseudonymous identifier, without tying identified data.</li>
<li>OUR - Ourselves and/or entities acting as our agents or entities for whom we are acting as an agent (can access the data).</li>
</ul>
</p>

<h3>Work around #4: Custom CSRF error page</h3>

<p>
This isn't really a work-around, and should probably be done anyway. But Django gives you the ability to define a <a href="https://docs.djangoproject.com/en/dev/ref/settings/#std:setting-CSRF_FAILURE_VIEW">custom error page</a> for CSRF validation errors, where could could tell the user what the problem is, and maybe have them to a manual frame break.
</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/blog/tags/#csrf" class="page__taxonomy-item p-category" rel="tag">csrf</a><span class="sep">, </span>
    
      <a href="/blog/tags/#django" class="page__taxonomy-item p-category" rel="tag">django</a><span class="sep">, </span>
    
      <a href="/blog/tags/#p3p" class="page__taxonomy-item p-category" rel="tag">p3p</a>
    
    </span>
  </p>






    <p class="page__date">
        <strong><i class="fas fa-fw fa-edit" aria-hidden="true"></i> GitHub:</strong>
        <a href="https://github.com/chase-seibert/blog/blob/master/_posts/2011-06-17-django-csrf-verification-failed-in-ie-iframe.html">_posts/2011-06-17-django-csrf-verification-failed-in-ie-iframe.html</a>
    </p>

        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2011-06-17T00:00:00+00:00">June 17, 2011</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2011/06/03/django-celery-with-postgres-connection-already-closed-errors.html" class="pagination--pager" title="django-celery with postgres: “connection already closed” errors">Previous</a>
    
    
      <a href="/blog/2011/06/24/creating-large-xml-files-in-python-with-saxutils.html" class="pagination--pager" title="Creating large XML files in Python with saxutils">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://chase-seibert.github.io">Chase Seibert Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>









  </body>
</html>
