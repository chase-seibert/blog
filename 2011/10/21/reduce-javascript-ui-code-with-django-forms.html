<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Reduce javascript UI code with Django forms - Chase Seibert Blog</title>
<meta name="description" content="Typically, I try to implement a dynamic UI feature without javascript on the first pass. Then, I layer in a little javascript goodness to make it more responsive. Whenever I stray from this practice, I inevitably end up re-discovering why I started doing this in the first place. At some point, I become horrified at the amount of javascript I have written, and disheartened at how long it&#39;s taking to modify. In short, things have gotten complicated.">


  <meta name="author" content="Chase Seibert">
  
  <meta property="article:author" content="Chase Seibert">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chase Seibert Blog">
<meta property="og:title" content="Reduce javascript UI code with Django forms">
<meta property="og:url" content="https://chase-seibert.github.io/blog/2011/10/21/reduce-javascript-ui-code-with-django-forms.html">


  <meta property="og:description" content="Typically, I try to implement a dynamic UI feature without javascript on the first pass. Then, I layer in a little javascript goodness to make it more responsive. Whenever I stray from this practice, I inevitably end up re-discovering why I started doing this in the first place. At some point, I become horrified at the amount of javascript I have written, and disheartened at how long it&#39;s taking to modify. In short, things have gotten complicated.">





  <meta name="twitter:site" content="@chase_seibert">
  <meta name="twitter:title" content="Reduce javascript UI code with Django forms">
  <meta name="twitter:description" content="Typically, I try to implement a dynamic UI feature without javascript on the first pass. Then, I layer in a little javascript goodness to make it more responsive. Whenever I stray from this practice, I inevitably end up re-discovering why I started doing this in the first place. At some point, I become horrified at the amount of javascript I have written, and disheartened at how long it&#39;s taking to modify. In short, things have gotten complicated.">
  <meta name="twitter:url" content="https://chase-seibert.github.io/blog/2011/10/21/reduce-javascript-ui-code-with-django-forms.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2011-10-21T00:00:00+00:00">






<link rel="canonical" href="https://chase-seibert.github.io/blog/2011/10/21/reduce-javascript-ui-code-with-django-forms.html">







  <meta name="google-site-verification" content="KbUN2yK33xTFIQa6xopl2QZyG02prTwsPwnCTjRRYMM" />






<!-- end _includes/seo.html -->



  <link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Chase Seibert Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon">
<a rel="me" href="https://hachyderm.io/@chase_seibert"></a>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/blog/">
          Chase Seibert Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/blog/me/"
                
                
              >Top Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/reading-list/"
                
                
              >Reading List</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/resume.pdf"
                
                
              >Resume</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://chase-seibert.github.io/blog/">
        <img src="/blog/images/chase-square.jpg" alt="Chase Seibert" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://chase-seibert.github.io/blog/" itemprop="url">Chase Seibert</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Director of Engineering at Dropbox</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">San Francisco, CA</span>
        </li>
      

      
        
          
            <li><a href="https://www.facebook.com/chase.seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://github.com/chase-seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.goodreads.com/chaseseibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-goodreads" aria-hidden="true"></i><span class="label">Goodreads</span></a></li>
          
        
          
            <li><a href="https://letterboxd.com/quasigenx/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-film" aria-hidden="true"></i><span class="label">Letterboxd</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/chaseseibert/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://hachyderm.io/@chase_seibert" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/7679" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Reduce javascript UI code with Django forms">
    <meta itemprop="description" content="Typically, I try to implement a dynamic UI feature without javascript on the first pass. Then, I layer in a little javascript goodness to make it more responsive. Whenever I stray from this practice, I inevitably end up re-discovering why I started doing this in the first place. At some point, I become horrified at the amount of javascript I have written, and disheartened at how long it&#39;s taking to modify. In short, things have gotten complicated.">
    <meta itemprop="datePublished" content="2011-10-21T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://chase-seibert.github.io/blog/2011/10/21/reduce-javascript-ui-code-with-django-forms.html" itemprop="url">Reduce javascript UI code with Django forms
</a>
          </h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>
Typically, I try to implement a dynamic UI feature without javascript on the first pass. Then, I layer in a little javascript goodness to make it more responsive. Whenever I stray from this practice, I inevitably end up re-discovering why I started doing this in the first place. At some point, I become horrified at the amount of javascript I have written, and disheartened at how long it's taking to modify. In short, things have gotten complicated.
</p>

<blockquote>
Everything should be made as simple as possible, but no simpler. - <a href="http://en.wikiquote.org/wiki/Albert_Einstein">Albert Einstein</a>
</blockquote>

<p>
Here is an example from just the other day. The requirements specified a form behavior that we didn't have already on the site. On a list of job records, there should be a close job link. Clicking the link reveals a new form that must be filled out successfully before the job is actually closed. When the form is successfully posted, hide the form and grey out the row. Here is the workflow:
</p>

<img src='http://lh4.googleusercontent.com/-lRGfcTgteRs/TqG6VGi-T6I/AAAAAAAALhk/TL5j8Y3b-JU/w545-h158-k/close_job1.png'>

<p>
Clicking close job actually just reveals the real form.
</p>

<img src='http://lh5.googleusercontent.com/-Skmw31d1HY8/TqG6UzBwPMI/AAAAAAAALhk/XFSjL5cRnE4/w545-h158-k/close_job2.png'>

<img src='http://lh4.googleusercontent.com/-Iw0wFSXn4n0/TqG6U6FDLsI/AAAAAAAALhk/Qlj1h6DjetA/w544-h158-n-k/close_job3.png'>

<p>
Attempting to post that form may throw validation exceptions.
</p>

<img src='http://lh3.googleusercontent.com/-CccK2SHiVT8/TqG6VaegA3I/AAAAAAAALhk/EhsF8xDAfV0/w544-h158-n-k/close_job4.png'>

<p>
When the form is successfully posted, it goes away and the row gets grayed out.
</p>

<p>
Of course, this is not an overly complicated example, but there are a few moving pieces. Nevertheless, I ended up with almost 100 lines of javascript code, even with the validation logic for the inner form being server side.
</p>

<pre name="code" class="javascript">
$(document).ready(function() {

 // hitting the initial close link, GETs the form from the back-end and shows it
 $(&quot;.jobs-record-list a.toggle-job-close&quot;).click(function (){

  var link = $(this);
  var record = link.parents(&quot;.record&quot;);
  var form_box = record.find(&quot;.job-close-form-box&quot;);
  var job_link = record.find(&quot;.title a&quot;);

  $.ajax({
   url: link.attr(&quot;href&quot;) + &quot;?ajax&quot;,
   type: &quot;GET&quot;,
   success: function (data) {
    form_box.html(data);
    bind_job_close_form(form_box);
   },
   error: function (jqXHR, textStatus, errorThrown) {
    // fallback to closing the job from the job overview page
    window.location = form.attr(job_link.attr(&quot;href&quot;));
   }
  });

  link.remove();
  return false;
 });

 // process the inner form submit to actually close the job, then put the open link back on the page
 function bind_job_close_form(form_box) {

  var form = form_box.find(&quot;form&quot;);
  var parentRow = form.parents(&quot;.record&quot;);

  form.submit(function () {

   $.ajax({
    url: form.attr(&quot;action&quot;) + &quot;?ajax&quot;,
    type: &quot;POST&quot;,
    data: form.serialize(),
    success: function (data) {
     form_box.hide();
     parentRow.find(&quot;.content&quot;).toggleClass(&quot;record-disabled&quot;);
     parentRow.find(&quot;.block&quot;).toggleClass(&quot;record-disabled&quot;);
     var link = form.find(&quot;a&quot;);
     link.text(link.text() == &quot;close job&quot; ? &quot;open job&quot; : &quot;close job&quot;);
    },
    error: function (jqXHR, textStatus, errorThrown) {
     form_box.html(jqXHR.response);
     bind_job_close_form(form_box); // rebind event handler
    }
   });

   return false;
  });
 }

        // if the page is refresh after the inner form is shown, re-show it
 $(&quot;form.toggle-job-open-closed&quot;).submit(function () {
  var form = $(this);
  var questions = form.find(&quot;.questions&quot;);
  if (questions.is(&quot;:hidden&quot;)) {
   questions.show();
   return false;
  }
  return true;
 });

 // re-opening a job, POST to the server then gray out the row
 $(&quot;a.toggle-job-open&quot;).submit(function () {

  var form = $(this);
  var parentRow = form.parents(&quot;.record&quot;);

  $.ajax({
   url: form.attr(&quot;action&quot;) + &quot;?ajax&quot;,
   data: form.serialize(),
   type: form.attr(&quot;method&quot;),
   success: function (data) {
    parentRow.find(&quot;.content&quot;).toggleClass(&quot;record-disabled&quot;);
    parentRow.find(&quot;.block&quot;).toggleClass(&quot;record-disabled&quot;);
   }
  });

  return false;
 });
});
</pre>

<p>
At this stage, my form is rather simple, but I have a view that's trying to do a lot; processing both the Ajax and non-javascript versions of requests this page. I'm also doing some craziness to pass the current form around in the session scope. This is so that if the user refreshes, the form is still in the same state. Here is just the form:
</p>

<pre name="code" class="python">
class OpenCloseJobForm(Html5Form):

    candidate = forms.ChoiceField(required=True)

    def __init__(self, *args, **kwargs):

        kwargs = helpers.copy_to_self(self, &quot;job&quot;, kwargs)
        super(OpenCloseJobForm, self).__init__(*args, **kwargs)

        self.fields[&quot;candidate&quot;].label = &quot;Who did you hire for this job?&quot;
        self.fields[&quot;candidate&quot;].required = False
        self.fields[&quot;candidate&quot;].choices = [(&quot;&quot;, &quot;-------------&quot;)]
        candidates = Candidate.objects.filter(job=self.job)
        self.fields[&quot;candidate&quot;].choices += [(&quot;Candidates&quot;, [(c.id, c) for c in candidates] + [(&quot;other&quot;, &quot;Someone else&quot; if candidates else &quot;Candidate not in %s&quot; % settings.SITE_NAME)])]
        self.fields[&quot;candidate&quot;].choices += [(&quot;none&quot;, &quot;No hire made&quot;)]

    def clean_candidate(self):
        candidate = self.cleaned_data.get(&quot;candidate&quot;)
        if not candidate:
            raise forms.ValidationError(&quot;This field is required.&quot;)
        return candidate

    def save(self):

        choice = self.data.get(&quot;candidate&quot;)

        if not choice:
            return None

        Hire.objects.filter(job=self.job).delete()

        if choice == &quot;none&quot;:
            return None

        candidate_id = choice
        candidate = None if choice == &quot;other&quot; else Candidate.objects.get(id=candidate_id)

        hire = Hire(job=self.job, candidate=candidate)
        hire.save()
        return hire
</pre>

<p>
At this point, I decide to refactor to move as much of the UI logic as possible into the form itself, and reduce the amount of javsacript. I end up with a widget and a form that implements the show/hide inner form behavior. That part grows from 40 lines to 90 lines.
</p>

<pre name="code" class="python">
class ToggleLinkWidget(widgets.HiddenInput):

    button_value = None

    def __init__(self, attrs=None, check_test=bool, button_value=&quot;toggle&quot;):
        super(ToggleLinkWidget, self).__init__(attrs)
        self.button_value = button_value

    def render(self, name, value, attrs=None):
        html = super(ToggleLinkWidget, self).render(name, value, attrs)
        link = &quot;&quot;
        if not value:
            button_value = self.button_value
            return &quot;&lt;input class='button-link' type='submit' name='%(name)s' value='%(button_value)s'&gt;&quot; % locals()
        return html

class OpenCloseJobForm(Html5Form):

    job_id = fields.CharField(required=True, widget=widgets.HiddenInput())
    expanded = fields.BooleanField(required=False, initial=False, widget=ToggleLinkWidget(button_value=&quot;close&quot;))
    candidate = fields.ChoiceField(required=True)

    def __init__(self, *args, **kwargs):

        super(OpenCloseJobForm, self).__init__(*args, **kwargs)
        self.job = Job.objects.get(id=self.data.get(&quot;job_id&quot;))

        self.fields[&quot;candidate&quot;].label = &quot;Who did you hire for this job?&quot;
        self.fields[&quot;candidate&quot;].required = False
        self.fields[&quot;candidate&quot;].choices = [(&quot;&quot;, &quot;-------------&quot;)]
        candidates = Candidate.objects.filter(job=self.job)
        self.fields[&quot;candidate&quot;].choices += [(&quot;Candidates&quot;, [(c.id, c) for c in candidates] + [(&quot;other&quot;, &quot;Someone else&quot; if candidates else &quot;Candidate not in %s&quot; % settings.SITE_NAME)])]
        self.fields[&quot;candidate&quot;].choices += [(&quot;none&quot;, &quot;No hire made&quot;)]

        # the close button is NOT toggled on; hide thother fields
        if not self.is_expanded():
            del self.fields[&quot;candidate&quot;]

        # don't show validation errors when first expanding the form
        if not self.data.get(&quot;inner-submit&quot;):
            self._errors = {}

    def is_valid(self):
        if self.data.get(&quot;inner-submit&quot;):
            return super(OpenCloseJobForm, self).is_valid()
        return False

    def is_expanded(self):
        return self.data and self.data.get(&quot;expanded&quot;) == &quot;close&quot;

    def as_ul(self):
        html = super(OpenCloseJobForm, self).as_ul()
        if self.is_expanded():
            button = &quot;&lt;input type='submit' name='inner-submit' value='Close Job'&gt;&quot;
            return mark_safe(&quot;&lt;div class='expanded-box'&gt;%(html)s %(button)s&lt;/div&gt;&quot; % locals())
        return html

    def clean_candidate(self):
        candidate = self.cleaned_data.get(&quot;candidate&quot;)
        if not candidate:
            raise forms.ValidationError(&quot;This field is required.&quot;)
        return candidate

    def save(self, request):

        self.job.is_open = not self.job.is_open

        if self.job.is_open:
            Hire.objects.filter(job=self.job).delete()
            messages.success(request, &quot;%s was set to open and is publicly available.&quot; % self.job)
        else:
            messages.success(request, &quot;%s was closed and is no longer available publicly.&quot; % self.job)

        self.job.save()

        choice = self.data.get(&quot;candidate&quot;)

        if not choice:
            return None

        Hire.objects.filter(job=self.job).delete()

        if choice == &quot;none&quot;:
            return None

        candidate_id = choice
        candidate = None if choice == &quot;other&quot; else Candidate.objects.get(id=candidate_id)

        hire = Hire(job=self.job, candidate=candidate)
        hire.save()
        return hire
</pre>

<p>
But look at the javascript, which has shrunk from 90 lines to 40.
</p>

<pre name="code" class="javascript">
$(document).ready(function() {

 function submit_handler() {

  var button = $(this);
  var record = button.parents(&quot;.record&quot;);
  var form = record.find(&quot;.job-prompt-hire-form&quot;);
  var form_box = form.parents(&quot;.form-box&quot;);
  var job_link = record.find(&quot;.title a&quot;);

  var form_data = form.serialize();
  // also record which input button was pressed
  if (button.is(&quot;.button-link&quot;)) {
   form_data = form_data += &quot;&amp;expanded=close&quot;;
  } else {
   form_data = form_data += &quot;&amp;inner-submit=Close Job&quot;;
  }

  $.ajax({
   url: form.attr(&quot;action&quot;) + &quot;?ajax&quot;,
   data: form_data,
   type: form.attr(&quot;method&quot;),
   success: function (data) {
    form_box.html(data);
    if (!data) {
     record.find(&quot;.content&quot;).toggleClass(&quot;record-disabled&quot;);
     record.find(&quot;.block&quot;).toggleClass(&quot;record-disabled&quot;);
    }
   },
   error: function (jqXHR, textStatus, errorThrown) {
    // fallback to closing the job from the job overview page
    window.location = form.attr(job_link.attr(&quot;href&quot;));
   }
  });

  return false;
 }

 // jQuery does not support live submit handling in IE
 // also, need to record actual pressed element
 $(&quot;.jobs-record-list .job-prompt-hire-form .button-link&quot;).live(&quot;click&quot;, submit_handler);
 $(&quot;.jobs-record-list .job-prompt-hire-form input[type=submit]&quot;).live(&quot;click&quot;, submit_handler);

});
</pre>

<p>
Interestingly, the total line count has remained around the same. This suggests that for my style, the code density of python and jQuery is about the same. Personally, I find the python code to be more maintainable. In particular, I very much like that I'm minimizing the number of times jQuery is changing the DOM, and rebinding events. All of the state transitions are happening in the form. As a side effect, the show/hide behavior is totally functional without javascript enabled.
</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/blog/tags/#django" class="page__taxonomy-item p-category" rel="tag">django</a><span class="sep">, </span>
    
      <a href="/blog/tags/#javascript" class="page__taxonomy-item p-category" rel="tag">javascript</a><span class="sep">, </span>
    
      <a href="/blog/tags/#unobtrusive" class="page__taxonomy-item p-category" rel="tag">unobtrusive</a>
    
    </span>
  </p>






    <p class="page__date">
        <strong><i class="fas fa-fw fa-edit" aria-hidden="true"></i> GitHub:</strong>
        <a href="https://github.com/chase-seibert/blog/blob/master/_posts/2011-10-21-reduce-javascript-ui-code-with-django-forms.html">_posts/2011-10-21-reduce-javascript-ui-code-with-django-forms.html</a>
    </p>

        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2011-10-21T00:00:00+00:00">October 21, 2011</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/2011/10/12/profile-and-reduce-memory-use-in-django-with-iterator.html" class="pagination--pager" title="Profile and reduce memory use in Django with .iterator()">Previous</a>
    
    
      <a href="/blog/2011/10/28/nagios-check-for-varnish-backends.html" class="pagination--pager" title="Nagios check for Varnish Backends">Next</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://chase-seibert.github.io">Chase Seibert Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blog/assets/js/main.min.js"></script>









  </body>
</html>
